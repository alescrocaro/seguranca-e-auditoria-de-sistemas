# Introdução a respeito de PenTeste
## o que é penteste?
O penteste consiste em testes de intrusão realizados por especialistas com o objetivo de identificar vulnerabilidades no sistema. Este esforço é contratado por uma empresa e as limitações do teste devem ser acordadas em contrato. Há vários tipos de penteste, como black box (quando não se tem nenhuma informação sobre o alvo), Double blind (igual ao anterior, mas o alvo também não sabe sobre o ataque), Gray box (o atacante tem algumas informações do alvo e o alvo sabe que será atacado), Double gray box (igual ao anterior, mas o alvo também tem algumas informações sobre o ataque), white box ("todos sabem tudo", o atacante tem informações prévias sobre o alvo e o alvo sabe o que será atacado) e Reversal (semelhante ao anterior, mas o alvo não sabe que será atacado). O profissional (ou empresa) pentester que irá atacar o sistema do contratante deve fazer um relatório detalhado sobre as vulnerabilidades encontradas. 

## passos
#### Definir limites
Neste passo deve-se entender onde o PenTeste será executado e quais são os objetivos do mesmo. As seguintes questões devem ser resolvidas:
- O que deve ser testado?
- Como deve ser testado?
- Em quais condições?
- Qual é o limite aceitável para o teste?
Além de ser definido o tipo de teste, os tipos foram definidos no tópico acima.

#### Obtendo Informações a Respeito do Alvo 
Esse passo tenta obter a maior quantidade possível de informações a respeito do alvo. Isso pode ser feito utilizando várias técnicas e ferramentas, mas basicamente esse passo consiste em obter informações que dizem respeito a: empresas, pessoas, serviços e tudo que está ligado direta ou indiretamente com o alvo. Por exemplo: (i) o executor do teste, pode obter informações de domínios da vítima na Internet, URLs, hosts, etc; (ii) vasculhar as redes sociais das pessoas ligadas ao alvo ou informações publicadas em outras fontes (blogs, justiça, etc).

#### Escaneamento 
Esse passo faz uma análise mais profunda e detalhada da estrutura alvo. Principalmente em hosts descobertos no passo anterior. Nesta fase são identificadas informações detalhadas a respeito de redes, hosts, sistema operacional. Também, nos hosts descobertos, são identificados, portas de redes abertas, serviços em execução e suas possíveis vulnerabilidades

#### Ganhando Acesso
É nesse passo que o profissional realizando o PenTest vai utilizar todas as informações levantadas nos passos anteriores para efetivamente fazer o teste de invasão no alvo. A invasão pode dar-se de várias formas, mas basicamente vai estar dentro dos seguintes contextos:
- Via Internet - WAN;
- Via rede local - LAN;
- Localmente no computador;
- Offline.

#### Mantendo o Acesso 
Após conseguir efetivamente explorar alguma vulnerabilidade e invadir o alvo. O profissional realizando o PenTeste pode empregar técnicas para Escalar Privilégios, demonstrando, por exemplo, que um invasor poderia acessar o alvo como um usuário comum e depois mudar para um usuário administrador, ou seja, com privilégios. Da mesma forma o profissional por trás do teste de segurança, pode por exemplo, instalar algum software, tal como backdoor, para demonstrar que invasores poderiam manter o acesso ao alvo. Algumas pessoas vão considerar que Escalar Privilégios também é mais um passo de PenTeste.

#### Documentação e Relatórios 
Após a realização do PenTest o profissional que o fez, ou a equipe, deve criar um documento dando o diagnóstico obtido depois do PenTeste. Ou seja, é necessário reportar para o cliente/alvo, tudo o que foi descoberto durante os testes. Assim, o cliente pode a partir desses documentos, pensar em formas de sanar ou pelo menos mitigar os problemas apontados pelo PenTest. Note, que pode ser necessário fazer relatórios e documentos distintos dependendo do setor da empresa que deve receber/ler tais resultados. Por exemplo, o gerente vai querer saber dos resultados de forma mais superficial, a nível de negócios (há problemas? quantos? o que eles podem causar?). Já o relatório para equipe de TI, deve informar detalhes mais técnicos (quais falhas foram exploradas? como? softwares? há como sanar?).

## Ferramentas 
- [Linux kali](https://www.kali.org) - uma distribuição GNU/Linux baseada no Debian. É voltado principalmente para auditoria e segurança de computadores em geral. É desenvolvido e mantido pela Offensive Security Ltd.
- [Nmap](https://nmap.org) - um software livre que realiza escaneamento de portas desenvolvido pelo Gordon Lyon, autoproclamado hacker "Fyodor". É muito utilizado para avaliar a segurança dos computadores, e para descobrir serviços ou servidores em uma rede de computadores. Nmap é conhecido pela sua rapidez e pelas opções que dispõe.
- Msfconsole - é a interface mais usada da [Metasploit Framework (MSF)](https://www.metasploit.com). Fornece um console central _‘all-in-one’_ com acesso a todas as opções da MSF. É intimidante ao inicio, mas despois de conhecer a sintaxe é fácil perceber seu potencial.

# Descrição a respeito do PenTeste realizado

## Comandos iniciais:
Primeiramente utilizo o **sudo su** para entrar em root, depois utilizo o **ifconfig** para descobrir o endereço do meu kali, que é 192.168.56.101/24 \
![image](https://user-images.githubusercontent.com/37521313/192106471-9d3aa2bb-bbb9-4e8b-96de-ae3f0df4c6ed.png)


## Escaneamento da rede: 
Como minha máquina tem a máscara 255.255.255.0, utilizo o * somente no último octeto para descobrir as outras máquinas da rede \
![nmap -sP](https://user-images.githubusercontent.com/37521313/192106413-931aedf7-b339-4d0b-98d5-4a819b41f87e.png)

Ao escanear todas máquinas utilizando a flag -sV (para saber o serviço e versão do software de rede em cada porta). \
![image](https://user-images.githubusercontent.com/37521313/192106651-f1fe4dae-6122-429d-a067-2286a6d8462b.png)

Analisando os comandos acima, percebe-se que a máquina .102 é a mais interessante de ser invadida por mostrar mais serviços que possivelmente terão falhas, e consequentemente deve ser o nosso alvo (a VM de redes 2). \

```bash
msfconsole  # utilizando esse comando, entramos em um console "tudo em um" que terá as ferramentas necessárias para tentar realizar a invasão
```

### Serviço ftp - vsftpd

Primeiramente procuramos pelo serviço vsftpd. 
![image](https://user-images.githubusercontent.com/37521313/192107103-a63f4002-67c3-462d-81ff-685b2b546eee.png)

Para utilizar o exploit, utiliza-se o comando use. Para verificar o que é preciso ser configurado, utiliza-se o comando options.

![image](https://user-images.githubusercontent.com/37521313/192110237-d8d797d0-6e04-4b7f-a3d3-fb0847f92920.png)

Como pode ser visto acima, RHOSTS não está configurado, para tanto, faz-se:

![image](https://user-images.githubusercontent.com/37521313/192110278-754ced39-bdf6-47bb-b0fd-f633897e361c.png)

Agora, usamos o comando exploit para tentar explorar a falha.

![image](https://user-images.githubusercontent.com/37521313/192110312-f96e70ba-0b61-474a-8432-fe67ae2dceb9.png)

Como visto acima, não foi possível criar uma sessão de usuário por precisar de senha.

### Serviço ssh

### Serviço Http - apache

![image](https://user-images.githubusercontent.com/37521313/192107483-38903787-ee89-4ad6-bf4e-f5d233447792.png)

Repetindo os comandos **options**, **use**, **set** e **exploit** para as possíveis falhas encontradas, não obtive sucesso, apareceram erros como os mostrados abaixo.

![image](https://user-images.githubusercontent.com/37521313/192107645-e502eb56-b0e8-4fc7-b019-17525dbfb94e.png)

![image](https://user-images.githubusercontent.com/37521313/192110841-ce3d3df1-c23f-4780-9344-60aafda2a8b6.png)


### Serviço telnet - Linux telnet

Pesquisa pelo serviço.
![image](https://user-images.githubusercontent.com/37521313/192111052-abad50a5-4647-46c1-8fa9-065e35b0a3f2.png)

Repetindo os comandos **options**, **use**, **set** e **exploit** para as possíveis falhas encontradas, não obtive sucesso, apareceram erros como os mostrados abaixo.

![image](https://user-images.githubusercontent.com/37521313/192111376-2878bfac-ce38-4d22-9574-0d7f7a87a5a1.png)

![image](https://user-images.githubusercontent.com/37521313/192111447-c3f0ece5-56a2-401a-87c3-f0e560e2da9e.png)


### Serviço nfs

![image](https://user-images.githubusercontent.com/37521313/192112338-f617f425-e29b-4265-809e-bb83fcc39868.png)

Pelo serviço 3, obtive os seguintes resultados.\
![image](https://user-images.githubusercontent.com/37521313/192109101-eb54e9d4-5a9a-43f6-947e-a54b92067a0a.png)

![image](https://user-images.githubusercontent.com/37521313/192118068-4adaad9d-b9ff-4caf-99c3-7101474e88f5.png)

Pelos prints acima, acredito que deveria ser feito algum tipo de engenharia social para conseguir se conectar via  ftp com o alvo. Algo como fazê-lo clicar em algum link ou ativar o serviço da porta 21.

Pelo serviço 7, consegui enviar um pacote dos. 
![image](https://user-images.githubusercontent.com/37521313/192111542-9381dadf-89ee-47c1-bfcf-5e676b2ad69c.png)

Para todos outros não obtive resultado, como na captura de tela abaixo.\
![image](https://user-images.githubusercontent.com/37521313/192111605-a4ea14c6-73ab-4d72-ae70-7d8131d035a3.png)



### SQL Injection
Ao acessar o ip 192.168.56.102 pelo browser, acessa-se o serviço apache do host alvo, como pode ser visto abaixo. \

![image](https://user-images.githubusercontent.com/37521313/192114194-9b31a5c2-8813-4807-8800-a058e3800e1f.png)

Pelos dados obtidos, parece ser o consumo de algum banco de dados, logo fiz uma busca por **Annek%** e foi obtido todos os nomes iniciados com "Anneke", portanto há um indício de que o SQL Injection é possível. Geralmente, ao utilizar um banco de dados para dados de usuário, o sobrenome ficará salvo como 'last_name', com tal raciocínio, pode-se fazer a seguinte consulta **Anneke%' and last_name LIKE 'p%' --**, dessa forma a busca retorna todos os nomes "Anneke P*". Seguindo nesse seguimento, pode ser possível alterar dados no banco, eu realizei os comandos a seguir, mas não obtive resultados positivos para o injection.

Annek%'; UNION SELECT * FROM USERS WHERE last_name LIKE 'a%';  -- 

Annek%'; INSERT into USERS (id, name, last_name) VALUES (1, 'teste', 'sobrenome'); -- 

Annek%'; UPDATE users SET last_name = 'goiaba' WHERE id = 10001; -- 

Annek%'; DELETE FROM USERS; -- 



# Relatório detalhando tudo o que foi descoberto no PenTeste.
## SQL Injection
### Como replicar?
Utilizar o campo de busca com o seguinte comando: \
Anne%' and last_name LIKE 'p%' -- 

### Descrição
Ao fazer uma busca no banco de dados encontrado no servidor web (Apache) é possível utilizar comandos da linguagem SQL, o que configura um SQL Injection, para realizar a consulta. Como existe essa vulnerabilidade, pode ser que seja possível alterar dados do banco, apesar de eu não ter conseguido.

## NFS
### Descrição
Encontrei a vulnerabilidade mais especificamente no serviço nfsaxe, com ela foi possível se conectar com o alvo e, se o alvo for enganado para ativar o serviço que o hacker está explorando, provavelmente será possível realizar a invasão.

# Conclusão a respeito das aulas a respeito de PenTeste, do PenTeste realizado por você, das facilidades e dificuldades durante o PenTeste.

# Referências
[Website cyberinfra](https://luizsantos.github.io/cyberinfra/docs/penTest/pentest) - Luiz Arthur Santos - Acessado em 24/09/2022.

[Descrição msfconsole](https://www.offensive-security.com/metasploit-unleashed/msfconsole/) - Offensive security - Acessado em 24/09/2022.

[Descrição nmap](https://pt.wikipedia.org/wiki/Nmap) - Wikipedia - Acessado em 24/09/2022.
